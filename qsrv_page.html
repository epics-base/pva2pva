<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>pva2pva: QSRV</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">pva2pva
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">QSRV </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="qsrv_config"></a>
QSRV Configuration</h1>
<p>By default QSRV exposes all Process Variables (fields of process database records). In addition to these "single" PVs are special "group" PVs.</p>
<h2><a class="anchor" id="qsrv_single"></a>
Single PVs</h2>
<p>"single" PVs are the same set of names server by the Channel Access server (RSRV). This is all accessible record fields. So all data which is accessible via Channel Access is also accessible via PVAccess.</p>
<p>QSRV presents all "single" PVs as Structures conforming to the Normative Types NTScalar, NTScalarArray, or NTEnum depending on the native DBF field type.</p>
<h2><a class="anchor" id="qsrv_group_def"></a>
Group PV definitions</h2>
<p>A group is defined using a JSON syntax. Groups are defined with respect to a Group Name, which is also the PV name. So unlike records, the "field" of a group have a different meaning. Group field names are <em>not</em> part of the PV name.</p>
<p>A group definition may be split among several records, or included in separate JSON file(s).</p>
<p>For example of a group including two records is:</p>
<div class="fragment"><div class="line">record(ai, <span class="stringliteral">&quot;rec:X&quot;</span>) {</div>
<div class="line">  info(Q:group, {</div>
<div class="line">    <span class="stringliteral">&quot;grp:name&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;X&quot;</span>: {+channel:<span class="stringliteral">&quot;VAL&quot;</span>}</div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line">}</div>
<div class="line">record(ai, <span class="stringliteral">&quot;rec:Y&quot;</span>) {</div>
<div class="line">  info(Q:group, {</div>
<div class="line">    <span class="stringliteral">&quot;grp:name&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;Y&quot;</span>: {+channel:<span class="stringliteral">&quot;VAL&quot;</span>}</div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line">}</div>
</div><!-- fragment --><p>Or equivalently with separate .db file and .json files.</p>
<div class="fragment"><div class="line"><span class="preprocessor"># some .db</span></div>
<div class="line"><span class="preprocessor"></span>record(ai, <span class="stringliteral">&quot;rec:X&quot;</span>) {}</div>
<div class="line">record(ai, <span class="stringliteral">&quot;rec:Y&quot;</span>) {}</div>
</div><!-- fragment --><div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;grp:name&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;X&quot;</span>: {+channel:<span class="stringliteral">&quot;VAL&quot;</span>},</div>
<div class="line">        <span class="stringliteral">&quot;Y&quot;</span>: {+channel:<span class="stringliteral">&quot;VAL&quot;</span>}</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>This group, named "grp:name", has two fields "X" and "Y".</p>
<div class="fragment"><div class="line">$ pvget grp:name</div>
<div class="line">grp:name</div>
<div class="line">structure </div>
<div class="line">    epics:nt/NTScalar:1.0 X</div>
<div class="line">        <span class="keywordtype">double</span> value 0</div>
<div class="line">        alarm_t alarm INVALID DRIVER UDF</div>
<div class="line">        time_t timeStamp &lt;undefined&gt; 0</div>
<div class="line">...</div>
<div class="line">    epics:nt/NTScalar:1.0 Y</div>
<div class="line">        <span class="keywordtype">double</span> value 0</div>
<div class="line">        alarm_t alarm INVALID DRIVER UDF</div>
<div class="line">        time_t timeStamp &lt;undefined&gt; 0</div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="qsrv_group_ref"></a>
Group PV reference</h2>
<div class="fragment"><div class="line">record(...) {</div>
<div class="line">    info(Q:group, {</div>
<div class="line">        <span class="stringliteral">&quot;&lt;group_name&gt;&quot;</span>:{</div>
<div class="line">            +<span class="keywordtype">id</span>:<span class="stringliteral">&quot;some/NT:1.0&quot;</span>,  # top level ID</div>
<div class="line">            +atomic:<span class="keyword">true</span>,       # whether monitors <span class="keywordflow">default</span> to multi-locking atomicity</div>
<div class="line">            <span class="stringliteral">&quot;&lt;field.name&gt;&quot;</span>:{</div>
<div class="line">                +type:<span class="stringliteral">&quot;scalar&quot;</span>, # controls how map VAL mapped onto &lt;field.name&gt;</div>
<div class="line">                +channel:<span class="stringliteral">&quot;VAL&quot;</span>,</div>
<div class="line">                +<span class="keywordtype">id</span>:<span class="stringliteral">&quot;some/NT:1.0&quot;</span>,</div>
<div class="line">                +trigger:<span class="stringliteral">&quot;*&quot;</span>,   # <span class="stringliteral">&quot;*&quot;</span> or comma seperated list of &lt;field.name&gt;s</div>
<div class="line">                +putorder:0,    # set <span class="keywordflow">for</span> fields where put is allowed, processing done in increasing order</div>
<div class="line">            },</div>
<div class="line">            <span class="stringliteral">&quot;&quot;</span>: {+type:<span class="stringliteral">&quot;meta&quot;</span>, +channel:<span class="stringliteral">&quot;VAL&quot;</span>} # special <span class="keywordflow">case</span> adds meta-data fields at top level</div>
<div class="line">        }</div>
<div class="line">    })</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="qsrv_group_map_types"></a>
Field mapping types</h3>
<ul>
<li>"scalar" or "" </li>
<li>"plain" </li>
<li>"any" </li>
<li>"meta" </li>
<li>"proc" </li>
<li>"structure"</li>
</ul>
<p>The "scalar" mapping places an NTScalar or NTScalarArray as a sub-structure.</p>
<p>The "plain" mapping ignores all meta-data and places only the "value" as a field. The "value" is equivalent to '.value' of the equivalent NTScalar/NTScalarArray as a field.</p>
<p>The "any" mapping places a variant union into which the "value" is placed.</p>
<p>The "meta" mapping ignores the "value" and places only the alarm and time meta-data as sub-fields. Placing an entry in a blank field name '"": {+type:"meta"}' allows these meta-data fields to be placed in the top-level structure.</p>
<p>The "proc" mapping uses neither "value" nor meta-data. Instead the target record is processed during a put.</p>
<p>The "structure" mapping allows an "+id" to be attached without a "+channel". So none of "+channel", "+trigger", nor "+putorder" are meaningful for a "structure" mapping.</p>
<h3><a class="anchor" id="qsrv_group_map_trig"></a>
Field Update Triggers</h3>
<p>The field triggers define how changes to the consitutent field are translated into a subscription update to the group.</p>
<p>The most use of these are "" which means that changes to the field are ignored, and do not result group update. And "*" which results in a group update containing the most recent values/meta-data of all fields.</p>
<p>It may be useful to specify a comma seperated list of field names so that changes may partially update the group.</p>
<h2><a class="anchor" id="qsrv_stamp"></a>
QSRV Timestamp Options</h2>
<p>QSRV has the ability to perform certain transformations on the timestamp before transporting it. The mechanism for configuring this is the "Q:time:tag" info() tag.</p>
<h3><a class="anchor" id="qsrv_stamp_nslsb"></a>
Nano-seconds least significant bits</h3>
<p>Setting "Q:time:tag" to a value of "nsec:lsb:#", where # is a number between 0 and 32, will split the nanoseconds value stored in the associated record. The least significant # bits are stored in the 'timeStamp.userTag' field. While the remaining 32-# bits are stored in 'timeStamp.nanoseconds' (without shifting).</p>
<p>For example, in the following situation 20 bits are split off into userTag. If the nanoseconds part of the record timestamp is 0x12345678, then the PVD structure would include "timeStamp.nanoseconds=0x12300000" and "timeStamp.userTag=0x45678".</p>
<div class="fragment"><div class="line">record(ai, <span class="stringliteral">&quot;...&quot;</span>) {</div>
<div class="line">  info(Q:time:tag, <span class="stringliteral">&quot;nsec:lsb:20&quot;</span>)</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="qsrv_form"></a>
QSRV Display Form Option</h2>
<p>The value of the OPI display form hint ('display.form') can be set set with the "Q:form" info() tag. This hint, along with 'display.precision', is used by some OPI clients to control how values are rendered.</p>
<p>The text value of the tag must be one of the following choices.</p>
<ul>
<li>Default </li>
<li>String </li>
<li>Binary </li>
<li>Decimal </li>
<li>Hex </li>
<li>Exponential </li>
<li>Engineering</li>
</ul>
<div class="fragment"><div class="line">record(ai, <span class="stringliteral">&quot;...&quot;</span>) {</div>
<div class="line">  info(Q:form, <span class="stringliteral">&quot;Default&quot;</span>) <span class="preprocessor"># implied default</span></div>
<div class="line"><span class="preprocessor">}</span></div>
</div><!-- fragment --><h2><a class="anchor" id="qsrv_aslib"></a>
Access Security</h2>
<p>QSRV will enforce an optional access control policy file (.acf) loaded by the usual means (cf. asSetFilename() ). This policy is applied to both Single and Group PVs. With Group PVs, restrictions are not defined for the group, but rather for the individual member records. The same policy will be applied regardess of how a record is accessed (individually, or through a group).</p>
<p>Policy application differs from CA (RSRV) in several ways:</p>
<p>Client hostname is always the numeric IP address. HAG() entries must either contained numeric IP addresses, or that asCheckClientIP=1 flag must be set to translate hostnames into IPs on ACF file load (effects CA server as well). This prevents clients from trivially forging "hostname". In additional to client usernames. UAG definitions may contained items beginning with "role/" which are matched against the list of groups of which the client username is a member. Username to group lookup is done internally to QSRV, and depends on IOC host authentication configuration. Note that this is still based on the client provided username string.</p>
<div class="fragment"><div class="line">UAG(special) {</div>
<div class="line">  someone, <span class="stringliteral">&quot;role/op&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The "special" UAG will match CA or PVA clients with the username "someone". It will also match a PVA client if the client provided username is a member of the "op" group (supported on POSIX targets and Windows).</p>
<h2><a class="anchor" id="qsrv_link"></a>
PVAccess Links</h2>
<p>When built against Base &gt;= 3.16.1, support is enabled for PVAccess links, which are analogous to Channel Access (CA) links. However, the syntax for PVA links is quite different.</p>
<dl class="section note"><dt>Note</dt><dd>The "dbjlr" and "dbpvar" IOC shell command provide information about PVA links in a running IOC.</dd></dl>
<p>A simple configuration using defaults is</p>
<div class="fragment"><div class="line">record(longin, <span class="stringliteral">&quot;tgt&quot;</span>) {}</div>
<div class="line">record(longin, <span class="stringliteral">&quot;src&quot;</span>) {</div>
<div class="line">    field(INP, {pva:<span class="stringliteral">&quot;tgt&quot;</span>})</div>
<div class="line">}</div>
</div><!-- fragment --><p>This is a shorthand for</p>
<div class="fragment"><div class="line">record(longin, <span class="stringliteral">&quot;tgt&quot;</span>) {}</div>
<div class="line">record(longin, <span class="stringliteral">&quot;src&quot;</span>) {</div>
<div class="line">    field(INP, {pva:{pv:<span class="stringliteral">&quot;tgt&quot;</span>}})</div>
<div class="line">}</div>
</div><!-- fragment --><p>Some additional keys (beyond "pv") may be used. Defaults are shown below:</p>
<div class="fragment"><div class="line">record(longin, <span class="stringliteral">&quot;tgt&quot;</span>) {}</div>
<div class="line">record(longin, <span class="stringliteral">&quot;src&quot;</span>) {</div>
<div class="line">    field(INP, {pva:{</div>
<div class="line">        pv:<span class="stringliteral">&quot;tgt&quot;</span>,</div>
<div class="line">        field:<span class="stringliteral">&quot;&quot;</span>,   # may be a sub-field</div>
<div class="line">        local:<span class="keyword">false</span>,# Require local PV</div>
<div class="line">        Q:4,        # monitor queue depth</div>
<div class="line">        pipeline:<span class="keyword">false</span>, # require that server uses monitor flow control protocol</div>
<div class="line">        proc:none,  # Request record processing (side-effects).</div>
<div class="line">        sevr:<span class="keyword">false</span>, # Maximize severity.</div>
<div class="line">        time:<span class="keyword">false</span>, # set record time during getValue</div>
<div class="line">        monorder:0, # Order of record processing as a result of CP and CPP</div>
<div class="line">        retry:<span class="keyword">false</span>,# allow Put <span class="keywordflow">while</span> disconnected.</div>
<div class="line">        always:<span class="keyword">false</span>,# CP/CPP input link process even when .value field hasn<span class="stringliteral">&#39;t changed</span></div>
<div class="line"><span class="stringliteral">        defer:false # Defer put</span></div>
<div class="line"><span class="stringliteral">    }})</span></div>
<div class="line"><span class="stringliteral">}</span></div>
</div><!-- fragment --><h3><a class="anchor" id="qsrv_link_pv"></a>
pv: Target PV name</h3>
<p>The PV name to search for. This is the same name which could be used with 'pvget' or other client tools.</p>
<h3><a class="anchor" id="qsrv_link_field"></a>
field: Structure field name</h3>
<p>The name of a sub-field of the remotely provided Structure. By default, an empty string "" uses the top-level Structure.</p>
<p>If the top level structure, or a sub-structure is selected, then it is expeccted to conform to NTScalar, NTScalarArray, or NTEnum to extract value and meta-data.</p>
<p>If the sub-field is an PVScalar or PVScalarArray, then a value will be taken from it, but not meta-data will be available.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Ability to traverse through unions and into structure arrays (as with group mappings).</dd></dl>
<h3><a class="anchor" id="qsrv_link_local"></a>
local: Require local PV</h3>
<p>When true, link will not connect unless the named PV is provided by the local (QSRV) data provider.</p>
<h3><a class="anchor" id="qsrv_link_Q"></a>
Q: Monitor queue depth</h3>
<p>Requests a certain monitor queue depth. The server may, or may not, take this into consideration when selecting a queue depth.</p>
<h3><a class="anchor" id="qsrv_link_pipeline"></a>
pipeline: Monitor flow control</h3>
<p>Expect that the server supports PVA monitor flow control. If not, then the subscription will stall (ick.)</p>
<h3><a class="anchor" id="qsrv_link_proc"></a>
proc: Request record processing (side-effects)</h3>
<p>The meaning of this option depends on the direction of the link.</p>
<p>For output links, this option allows a request for remote processing (side-effects).</p>
<ul>
<li>none (default) - Make no special request. Uses a server specific default. </li>
<li>false, "NPP" - Request to skip processing. </li>
<li>true, "PP" - Request to force processing. </li>
<li>"CP", "CPP" - For output links, an alias for "PP".</li>
</ul>
<p>For input links, this option controls whether the record containing the PVA link will be processed when subscription events are received.</p>
<ul>
<li>none (default), false, "NPP" - Do not process on subscription updates. </li>
<li>true, "CP" - Always process on subscription updates. </li>
<li>"PP", "CPP" - Process on subscription updates if SCAN=Passive</li>
</ul>
<h3><a class="anchor" id="qsrv_link_sevr"></a>
sevr: Alarm propagation</h3>
<p>This option controls whether reading a value from an input PVA link has the addition effect of propagating any alarm via the Maximize Severity process.</p>
<ul>
<li>false - Do not maximize severity. </li>
<li>true - Maximize alarm severity </li>
<li>"MSI" - Maximize only if the remote severity is INVALID.</li>
</ul>
<h3><a class="anchor" id="qsrv_link_time"></a>
time: Time propagation</h3>
<p>Somewhat analogous to sevr: applied to timestamp. When true, the record TIME field is updated when the link value is read.</p>
<dl class="section warning"><dt>Warning</dt><dd>TSEL must be set to -2 for time:true to have an effect.</dd></dl>
<h3><a class="anchor" id="qsrv_link_monorder"></a>
monorder: Monitor processing order</h3>
<p>When multiple record target the same target PV, and request processing on subscription updates. This option allows the order of processing to be specified.</p>
<p>Record are processed in increasing order. monorder=-1 is processed before monorder=0. Both are processed before monorder=1.</p>
<h3><a class="anchor" id="qsrv_link_defer"></a>
defer: Defer put</h3>
<p>By default (defer=false) an output link will immediately start a PVA Put operation. defer=true will store the new value in an internal cache, but not start a PVA Put.</p>
<p>This option, in combination with field: allows a single Put to contain updates to multiple sub-fields.</p>
<h3><a class="anchor" id="qsrv_link_retry"></a>
retry: Put while disconnected</h3>
<p>Allow a Put operation to be queued while the link is disconnected. The Put will be executed when the link becomes connected.</p>
<h3><a class="anchor" id="qsrv_link_always"></a>
always: CP/CPP always process</h3>
<p>By default (always:false) a subscription update will only cause a CP input link to scan if the structure field (cf. field: option) is marked as changed. Set to true to override this, and always process the link.</p>
<h3><a class="anchor" id="qsrv_link_sem"></a>
Link semantics/behavior</h3>
<p>This section attempts to answer some questions about how links behave in certain situations.</p>
<p>Links are evaluated in three basic contexts.</p>
<ul>
<li>dbPutLink()/dbScanFwdLink() </li>
<li>dbGetLink() of non-CP link </li>
<li>dbGetLink() during a scan resulting from a CP link.</li>
</ul>
<p>An input link can bring in a Value as well as meta-data, alarm, time, and display/control info. For input links, the PVA link engine attempts to always maintain consistency between Value, alarm, and time. However, consistency between these, and the display/control info is only ensured during a CP scan. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
